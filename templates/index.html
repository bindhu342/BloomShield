<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BloomShield | Protection in storage, Privacy in search</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --neon-blue: #3b82f6; --darkest: #010409; }
        body { font-family: 'Space Grotesk', sans-serif; background-color: var(--darkest); color: #ffffff; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .glass { background: rgba(3, 7, 18, 0.98); backdrop-filter: blur(20px); border: 1px solid rgba(59, 130, 246, 0.3); box-shadow: 0 15px 35px rgba(0,0,0,0.8); }
        .cyber-grid { background-image: linear-gradient(to right, #080c14 1px, transparent 1px), linear-gradient(to bottom, #080c14 1px, transparent 1px); background-size: 50px 50px; }
        .scanline { width: 100%; height: 2px; background: var(--neon-blue); opacity: 0.2; position: absolute; animation: move 4s linear infinite; }
        @keyframes move { 0% { top: 0% } 100% { top: 100% } }
        .btn-hack { background: linear-gradient(90deg, #450a0a, #991b1b); border: 1px solid #ef4444; transition: all 0.3s ease; }
        .btn-hack:hover { background: #b91c1c; box-shadow: 0 0 25px rgba(239, 68, 68, 0.5); }
        .glow-text-blue { text-shadow: 0 0 15px rgba(59, 130, 246, 0.6); }
        input { background-color: #000000 !important; border: 1px solid #1e293b !important; color: #60a5fa !important; }
    </style>
</head>
<body class="min-h-screen p-4 md:p-8 relative overflow-x-hidden">
    <div class="fixed inset-0 cyber-grid -z-10"></div>

    <header class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center mb-10 gap-4">
        <div class="flex items-center gap-3">
            <div class="p-3 bg-blue-950 rounded-xl border border-blue-500">
                <i data-lucide="shield-check" class="text-blue-400 w-8 h-8"></i>
            </div>
            <div>
                <h1 class="text-3xl font-bold tracking-tighter uppercase italic glow-text-blue">Bloom<span class="text-blue-500">Shield</span></h1>
                <div class="flex items-center gap-2">
                    <p class="text-[10px] mono text-blue-800 tracking-[0.2em] font-bold uppercase">Protection in storage, Privacy in search</p>
                    <span class="px-2 py-0.5 rounded text-[9px] bg-green-500/20 text-green-400 border border-green-500/50 mono animate-pulse">STATUS: ACTIVE</span>
                </div>
            </div>
        </div>
        <a href="/dataset" class="flex items-center gap-2 bg-blue-600/10 border border-blue-500 text-blue-400 px-6 py-2 rounded-xl font-bold hover:bg-blue-600 hover:text-white transition-all">
            Dataset Search <i data-lucide="arrow-right" class="w-4 h-4"></i>
        </a>
    </header>

    <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8">
        <div class="lg:col-span-4 space-y-6">
            <section class="glass p-6 rounded-2xl relative overflow-hidden">
                <div class="scanline"></div>
                <h2 class="text-sm font-bold text-blue-400 mb-6 flex items-center gap-2 uppercase tracking-wider">
                    <i data-lucide="database" class="w-4 h-4"></i> Data Control
                </h2>
                <form method="POST" class="space-y-4">
                    <input name="text" placeholder="Enter text for Bloom..." required class="w-full rounded-xl p-4 text-sm outline-none transition-all">
                    <div class="grid grid-cols-2 gap-3">
                        <button name="action" value="insert" class="bg-blue-600 hover:bg-blue-500 text-white font-extrabold py-3 rounded-xl transition-all uppercase">INSERT</button>
                        <button name="action" value="search" class="bg-transparent border-2 border-blue-500 text-blue-400 font-extrabold py-3 rounded-xl transition-all hover:bg-blue-500/10 uppercase">SEARCH</button>
                    </div>
                </form>
                <div class="mt-8 pt-6 border-t border-slate-900">
                    <div class="text-[10px] text-slate-500 mb-1 mono">STATUS:</div>
                    <div class="text-xl font-bold text-blue-400 min-h-[1.2em] mb-4 glow-text-blue">{{ insert_bloom_result }}</div>
                    <div class="text-[10px] text-slate-500 mb-1 mono">BIT_INDICES:</div>
                    <div class="mono text-[11px] text-yellow-500 bg-black p-3 rounded-lg border border-yellow-950 break-all">{{ insert_indices }}</div>
                </div>
            </section>

            <section class="glass p-6 rounded-2xl border-red-900/50">
                <h2 class="text-sm font-bold text-red-500 mb-4 flex items-center gap-2 uppercase italic">
                    <i data-lucide="skull" class="w-4 h-4"></i> Adversary Simulation
                </h2>
                <button onclick="runAttack()" class="btn-hack w-full py-4 text-white rounded-xl font-black text-xs flex items-center justify-center gap-2 tracking-widest uppercase">
                    <i data-lucide="zap" class="w-4 h-4"></i> Run Hack
                </button>
                <div id="attackBox" class="mt-4 hidden">
                    <div class="p-4 bg-black border border-red-900 rounded-xl text-center">
                        <p class="text-[10px] text-red-500 mono uppercase mb-1">Hack Detected</p>
                        <div id="attackResult" class="text-3xl font-black text-red-500 mono py-2">0 / 0</div>
                    </div>
                </div>
            </section>
        </div>

        <div class="lg:col-span-8">
            <div class="glass p-6 rounded-2xl h-full flex flex-col">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-sm font-bold text-blue-400 uppercase tracking-widest glow-text-blue">Bloom Filter Saturation</h2>
                    <div class="flex gap-6">
                        <button onclick="toggleChartType()" class="text-slate-500 hover:text-blue-400 flex items-center gap-2 text-[10px] mono uppercase">
                            <i data-lucide="layout-dashboard" class="w-4 h-4"></i>
                            <span id="toggleText">Bar View</span>
                        </button>
                        <button onclick="loadGraph()" class="text-slate-500 hover:text-blue-400">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        </button>
                    </div>
                </div>
                <div class="flex-grow flex items-center justify-center py-2 min-h-[300px]">
                    <div style="position: relative; height:320px; width:100%; max-width:500px">
                        <canvas id="chart"></canvas>
                    </div>
                </div>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                    <div class="bg-black p-4 rounded-xl border border-blue-900/20"><p class="text-[9px] text-blue-700 font-bold uppercase">Privacy</p><p class="text-lg font-bold text-green-500 mono">MAX</p></div>
                    <div class="bg-black p-4 rounded-xl border border-blue-900/20"><p class="text-[9px] text-blue-700 font-bold uppercase">Integrity</p><p class="text-lg font-bold text-white mono">100%</p></div>
                    <div class="bg-black p-4 rounded-xl border border-blue-900/20"><p class="text-[9px] text-blue-700 font-bold uppercase">Algorithm</p><p class="text-lg font-bold text-white mono">SHA-256</p></div>
                    <div class="bg-black p-4 rounded-xl border border-blue-900/20"><p class="text-[9px] text-blue-700 font-bold uppercase">Latency</p><p class="text-lg font-bold text-blue-400 mono">< 1ms</p></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        lucide.createIcons();
        let myChart;
        let currentChartType = 'doughnut';

        function toggleChartType() {
            currentChartType = (currentChartType === 'doughnut') ? 'bar' : 'doughnut';
            document.getElementById('toggleText').innerText = (currentChartType === 'doughnut') ? 'Bar View' : 'Pie View';
            loadGraph();
        }

        function loadGraph(){
            fetch("/graph").then(res => res.json()).then(data => {
                const ctx = document.getElementById("chart").getContext('2d');
                if (myChart) myChart.destroy();
                myChart = new Chart(ctx, {
                    type: currentChartType,
                    data: {
                        labels: ["Active Bits", "Available Bits"],
                        datasets: [{
                            data: [data.active, data.available],
                            backgroundColor: ['#3b82f6', '#1e293b'],
                            borderColor: ['#60a5fa', '#334155'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { labels: { color: '#94a3b8', font: { family: 'JetBrains Mono' } } }
                        },
                        scales: currentChartType === 'bar' ? {
                            y: { ticks: { color: '#94a3b8' }, grid: { color: '#1e293b' } },
                            x: { ticks: { color: '#94a3b8' }, grid: { color: '#1e293b' } }
                        } : {}
                    }
                });
            });
        }

        function runAttack() {
            fetch("/attack").then(res => res.json()).then(data => {
                document.getElementById('attackBox').classList.remove('hidden');
                document.getElementById('attackResult').innerText = data.cracked + " / " + data.total;
            });
        }

        loadGraph();
    </script>
</body>
</html>